<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Luisa Spanish Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    body {
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #121212 !important;
      color: #f8f9fa !important;
    }
    .dark-mode .card {
      background-color: rgba(30, 30, 30, 0.7);
      color: #fff;
      backdrop-filter: blur(10px);
    }
    .card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(200, 200, 200, 0.2);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }
    .game-board {
      max-width: 900px;
      margin: auto;
    }
    .word-box {
      cursor: grab;
      padding: 10px 14px;
      border-radius: 8px;
      user-select: none;
      transition: box-shadow 0.3s, transform 0.3s;
      min-height: 44px;
      min-width: 120px;
      animation: fadeIn 0.4s ease;
      text-align: center;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .word-box:hover { transform: scale(1.02); }
    .correct { box-shadow: 0 0 10px 3px green; }
    .wrong {
      animation: shake 0.3s;
      box-shadow: 0 0 10px 3px red;
    }
    .matched {
      background-color: #d4edda !important;
      color: #155724 !important;
      border: 1px solid #c3e6cb;
      cursor: default;
    }
    @keyframes shake {
      10% { transform: translateX(-5px); }
      20% { transform: translateX(5px); }
      30% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
    }
    .word-column {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      min-height: 300px;
    }
    #log {
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
      background: #f1f1f1;
      border: 1px solid #ccc;
      padding: 10px;
      font-family: monospace;
      font-size: 0.9em;
    }
    .dark-mode #log {
      background-color: #1d1d1d;
      color: #ccc;
      border-color: #444;
    }

    @media (max-width: 768px) {
      .word-box {
        font-size: 0.85rem;
        padding: 6px 8px;
        min-width: 90px;
        min-height: 36px;
      }
      .word-column {
        gap: 8px;
        align-items: stretch;
      }
      .game-board .row {
        flex-wrap: nowrap;
        gap: 10px;
        overflow-x: hidden;
      }
    }
  </style>
</head>
<body class="bg-light text-dark">
<div class="container py-4">

  <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-4">
    <h2 class="mb-0">üß† Luisa Learn - Word Matching Game üß†</h2>
    <select class="form-select w-auto" id="category"></select>
    <button class="btn btn-success" onclick="startGame()">üéÆ Start</button>
    <button id="modeToggleBtn" class="btn btn-outline-dark btn-sm toggle-mode-btn" onclick="toggleDarkMode()">üåì</button>
  </div>

  <div class="card p-3 mb-4 game-board">
    <div class="row d-flex" id="gameRow">
      <div class="col-md-6">
        <h5 class="text-center">üá™üá∏ Spanish</h5>
        <div id="spanishColumn" class="word-column"></div>
      </div>
      <div class="col-md-6">
        <h5 class="text-center">üá∫üá∏ English</h5>
        <div id="englishColumn" class="word-column"></div>
      </div>
    </div>
  </div>

  <div id="scoreBarWrap" class="text-center mb-3">
    <div id="score" class="fw-bold mb-2">Score: 0%</div>
    <div class="progress mb-2" style="height: 20px;">
      <div id="scoreBar" class="progress-bar bg-success" style="width: 0%">0%</div>
    </div>
    <button class="btn btn-outline-primary mt-2" onclick="startGame()">üîÅ Play Again</button>
    <button class="btn btn-outline-secondary ms-2 mt-2" onclick="toggleLog()">üìù Toggle Log</button>
    <button id="reviewBtn" class="btn btn-outline-info ms-2 mt-2 d-none" onclick="showReview()">üìñ Review</button>
  </div>

  <div id="log" class="d-none">üßæ Log:</div>

  <!-- Review Modal -->
  <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reviewModalLabel">üìñ Correct Pairs</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul id="correctPairs" class="list-group"></ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

<script>
let fullDict = {};
let wordPairs = [], score = 0, attempts = 0, selectedSpanish = null;

const emojiMap = {
  travel: "‚úàÔ∏è", family: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", school: "üè´", office: "üíº", shopping: "üõçÔ∏è", online: "üíª",
  food: "üçî", animals: "üê∂", colors: "üé®", sports: "üèÄ", weather: "‚õÖ", body: "üßç",
  home: "üè†", jobs: "üë∑", emotions: "üòÑ", adjectives: "üß†", nature: "üåø", numbers: "üî¢",
  furniture: "ü™ë", kitchen: "üçΩÔ∏è", bathroom: "üöø", vehicles: "üöó", materials: "üß±",
  countries: "üó∫Ô∏è", places: "üè¢", time: "‚è∞", verbs: "üèÉ‚Äç‚ôÇÔ∏è", technology: "üíª", clothes: "üëï",
  days: "üìÖ"
};

function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
  const btn = document.getElementById("modeToggleBtn");
  btn.classList.toggle("btn-outline-dark");
  btn.classList.toggle("btn-warning");
}

function toggleLog() {
  document.getElementById("log").classList.toggle("d-none");
}

function log(msg) {
  const logDiv = document.getElementById("log");
  logDiv.innerText += `\n[${new Date().toLocaleTimeString()}] ${msg}`;
  logDiv.scrollTop = logDiv.scrollHeight;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

async function loadJSON() {
  try {
    const res = await fetch("words.json");
    fullDict = await res.json();
    log("‚úÖ Loaded words.json successfully.");
  } catch (err) {
    fullDict = {
      travel: [["ticket", "boleto"], ["flight", "vuelo"], ["passport", "pasaporte"], ["hotel", "hotel"]],
      family: [["father", "padre"], ["mother", "madre"], ["brother", "hermano"], ["sister", "hermana"]]
    };
    log("‚ö†Ô∏è Failed to load words.json. Using fallback.");
  }

  const dropdown = document.getElementById("category");
  dropdown.innerHTML = '<option value="random">üé≤ Random</option>';
  Object.keys(fullDict).forEach(cat => {
    const clean = cat.toLowerCase().replace(/\d+$/, '');
    const emoji = emojiMap[clean] || "üìö";
    const opt = document.createElement("option");
    opt.value = cat;
    opt.innerText = `${ emoji} ${cat.charAt(0).toUpperCase() + cat.slice(1)}`;
    dropdown.appendChild(opt);
  });
}

function updateScoreBar() {
  const percent = attempts > 0 ? Math.floor((score / attempts) * 100) : 0;
  document.getElementById("score").innerText = `Score: ${percent}%`;
  const bar = document.getElementById("scoreBar");
  bar.style.width = `${percent}%`;
  bar.innerText = `${percent}%`;
}

function startGame() {
  const cat = document.getElementById("category").value;
  const categories = cat === "random" ? Object.keys(fullDict) : [cat];
  const merged = categories.flatMap(c => fullDict[c]);
  shuffle(merged);
  wordPairs = merged.slice(0, 6).map(([eng, esp]) => ({ english: eng, spanish: esp }));
  score = 0; attempts = 0; selectedSpanish = null;
  document.getElementById("log").innerText = "üßæ Log:";
  document.getElementById("reviewBtn").classList.add("d-none");
  updateScoreBar();
  loadRound();
}

function loadRound() {
  const sCol = document.getElementById("spanishColumn");
  const eCol = document.getElementById("englishColumn");
  sCol.innerHTML = ""; eCol.innerHTML = "";

  const spanish = [...wordPairs];
  const english = [...wordPairs];
  shuffle(spanish); shuffle(english);

  spanish.forEach(pair => {
    const el = document.createElement("div");
    el.className = "word-box btn btn-outline-secondary text-center";
    el.innerText = pair.spanish;
    el.setAttribute("draggable", true);
    el.dataset.word = pair.english;

    el.ondragstart = ev => {
      if (el.classList.contains("matched")) return;
      ev.dataTransfer.setData("text/plain", pair.english);
      selectedSpanish = pair;
      log(`üß† Dragging: ${pair.spanish}`);
    };

    el.onclick = () => {
      if (el.classList.contains("matched")) return;
      selectedSpanish = pair;
      log(`üß† Selected: ${pair.spanish}`);
    };

    sCol.appendChild(el);
  });

  english.forEach(pair => {
    const el = document.createElement("div");
    el.className = "word-box btn btn-outline-primary text-center";
    el.innerText = pair.english;
    el.dataset.target = pair.english;

    el.ondragover = ev => ev.preventDefault();

    el.ondrop = ev => {
      if (el.classList.contains("matched")) return;
      ev.preventDefault();
      const draggedEng = ev.dataTransfer.getData("text/plain");
      attemptMatch(pair, el, draggedEng);
    };

    el.onclick = () => {
      if (!selectedSpanish || el.classList.contains("matched")) return;
      attemptMatch(pair, el, selectedSpanish.english);
      selectedSpanish = null;
    };

    eCol.appendChild(el);
  });
}

function showReview() {
  const correctPairsList = document.getElementById("correctPairs");
  correctPairsList.innerHTML = "";
  wordPairs.forEach(pair => {
    const li = document.createElement("li");
    li.className = "list-group-item";
    li.innerText = `${pair.spanish} ‚Üí ${pair.english}`;
    correctPairsList.appendChild(li);
  });
  const modal = new bootstrap.Modal(document.getElementById("reviewModal"));
  modal.show();
  log("üìñ Review modal opened");
}

function attemptMatch(pair, el, draggedEng) {
  attempts++;
  const spanishWord = wordPairs.find(p => p.english === draggedEng)?.spanish || "unknown";
  if (draggedEng === pair.english) {
    score++;
    el.classList.add("matched");
    el.innerHTML = `${pair.english} <span class="badge bg-success">‚úîÔ∏è</span>`;
    const spanishTile = document.querySelector(`[data-word="${draggedEng}"]`);
    if (spanishTile) {
      spanishTile.classList.add("matched");
      spanishTile.setAttribute("draggable", false);
      spanishTile.innerHTML += ` <span class="badge bg-success">‚úîÔ∏è</span>`;
    }
    confetti({ particleCount: 60, spread: 70, origin: { y: 0.5 } });
    log(`‚úÖ Match: ${spanishWord} ‚Üí ${pair.english}`);
    if (score === wordPairs.length) {
      document.getElementById("reviewBtn").classList.remove("d-none");
      log("üèÜ Game completed! Review button enabled.");
    }
  } else {
    el.classList.add("wrong");
    setTimeout(() => el.classList.remove("wrong"), 500);
    log(`‚ùå Wrong: ${spanishWord} ‚Üí ${pair.english}`);
  }
  updateScoreBar();
}

loadJSON();
</script>
</body>
</html>